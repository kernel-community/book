const fs = require('fs');
const path = require('path');

const BLOG_DIR = path.join(process.cwd(), 'content', 'blog');
const LOADERS_PATH = path.join(process.cwd(), 'src', 'data', 'blog-loaders.ts');

if (!fs.existsSync(BLOG_DIR)) {
  console.log('Blog directory does not exist, skipping blog loader generation.');
  process.exit(0);
}

const files = fs.readdirSync(BLOG_DIR);
const mdxFiles = files.filter(file => file.endsWith('.mdx'));

const loaderEntries = mdxFiles
  .map((file) => {
    const slug = file.replace(/\.mdx$/, '');
    return `  "${slug}": () => import("../../content/blog/${file}"),`;
  })
  .sort() // Sort alphabetically for consistency
  .join('\n');

const loaderFile = `// Auto-generated by scripts/build-blog-loaders.js. Do not edit manually.
// Maps blog slug to a lazy MDX import.

export const blogLoaders: Record<string, () => Promise<{ default: React.ComponentType }>> = {
${loaderEntries}
};
`;

fs.mkdirSync(path.dirname(LOADERS_PATH), { recursive: true });
fs.writeFileSync(LOADERS_PATH, loaderFile);
console.log(`Wrote ${mdxFiles.length} blog loaders to ${LOADERS_PATH}`);


